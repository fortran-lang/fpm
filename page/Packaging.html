<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="Fortran Package Manager">
    <meta name="author" content="fortran-lang/fpm contributors" >
    <link rel="icon" href="../favicon.png">

    <title>Packaging with fpm &ndash; Fortran-lang/fpm</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Font Awesome -->
    <link href="../css/fontawesome.min.css" rel="stylesheet">
    <link href="../css/brands.min.css" rel="stylesheet">
    <link href="../css/regular.min.css" rel="stylesheet">
    <link href="../css/solid.min.css" rel="stylesheet">
    <link href="../css/v4-font-face.min.css" rel="stylesheet">
    <link href="../css/v4-shims.min.css" rel="stylesheet">
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async
            integrity="sha256-DViIOMYdwlM/axqoGDPeUyf0urLoHMN4QACBKyB58Uw=" crossorigin="anonymous"></script>
    <!-- Other scripts and stylesheets -->
    <link href="../css/local.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <script src="../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">Fortran-lang/fpm </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="index.html">Packaging and contributing</a></li>
                  <li class="nav-item">
                    <a class="nav-link" href="../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/modules.html">Modules</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/types.html">Derived Types</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../program/main.html">Program</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>Packaging with fpm</h1>
    <div class="container p-2 mb-4 bg-light border rounded-3">
      <div class="row align-items-center justify-content-between">
        <div class="col">
          <ul class="list-inline" style="margin-bottom:0px; display:inline">
          </ul>
        </div>
        <div class="col">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='index.html'>Packaging and contributing</a></li>
              <li class="breadcrumb-item active" aria-current="page">Packaging with fpm</li>
            </ol>
          </nav>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
      <div class="col-3">
        <div class="card card-body bg-light" id="sidebar-toc">
          <ul class="nav flex-column align-items">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Packaging and contributing</a>
            </li>
          </ul>
          <hr>
          <nav class="nav nav-pills flex-column">
              <a class="nav-link" href="Contributing.html">Contributing Guidelines</a>
              <a class="nav-link" href="License.html">License</a>
              <a class="nav-link" href="Manifest.html">Manifest reference</a>
              <a class="nav-link active disabled" href="Packaging.html">Packaging with fpm</a>
          </nav>
        </div>
      </div>

    <div class="col-9" id='text'>
      <h1 id="preparing-your-package-for-fpm">Preparing your package for FPM</h1>
<p>This document describes how you need to organize your application or library for
it to successfully build with the Fortran Package Manager (<em>fpm</em>).</p>
<ul>
<li><a href="#what-kind-of-package-can-fpm-build">What kind of package can fpm build?</a></li>
<li><a href="#example-package-layouts">Example package layouts</a></li>
<li><a href="#single-program">Single program</a></li>
<li><a href="#single-module-library">Single-module library</a></li>
<li><a href="#multi-module-library">Multi-module library</a></li>
<li><a href="#application-and-library">Application and library</a></li>
<li><a href="#multi-level-library">Multi-level library</a></li>
<li><a href="#be-more-explicit">Be more explicit</a></li>
<li><a href="#add-some-tests">Add some tests</a></li>
<li><a href="#adding-dependencies">Adding dependencies</a></li>
<li><a href="#custom-build-scripts">Custom build scripts</a></li>
</ul>
<h2 id="what-kind-of-package-can-fpm-build">What kind of package can fpm build?</h2>
<p>You can use <em>fpm</em> to build:</p>
<ul>
<li>Applications (program only)</li>
<li>Libraries (modules only)</li>
<li>Combination of the two (programs and modules combined)</li>
</ul>
<p>Let’s look at some examples of different kinds of package layouts that you can
use with <em>fpm</em>.</p>
<h2 id="example-package-layouts">Example package layouts</h2>
<p>This section describes some example package layouts that you can build with
<em>fpm</em>. You can use them to model the layout of your own package.</p>
<h3 id="single-program">Single program</h3>
<p>Let’s start with the simplest package imaginable—a single program without
dependencies or modules. Here’s what the layout of the top-level directory
looks like:</p>
<div class="codehilite"><pre><span></span><code>.
├── app
│   └── main.f90
└── fpm.toml
</code></pre></div>

<p>We have one source file (<code>main.f90</code>) in one directory (<code>app</code>). Its contents
are:</p>
<div class="codehilite"><pre><span></span><code><span class="k">program </span><span class="n">main</span>
<span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Hello, World!&#39;</span>
<span class="k">end program </span><span class="n">main</span>
</code></pre></div>

<p>This program prints the usual greeting to the standard output, and nothing more.</p>
<p>There’s another important file in the top-level directory, <code>fpm.toml</code>.  This is
<em>fpm</em>’s configuration file specific to your package.  It includes all the data
that <em>fpm</em> needs to build your app.  In our simple case, it looks like this:</p>
<div class="codehilite"><pre><span></span><code><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;hello&quot;</span>
<span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0.1.0&quot;</span>
<span class="n">license</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;MIT&quot;</span>
<span class="n">author</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Jane Programmer&quot;</span>
<span class="n">maintainer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;jane@example.com&quot;</span>
<span class="n">copyright</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2020 Jane Programmer&quot;</span>
</code></pre></div>

<p>The preamble includes some metadata, such as <code>license</code>, <code>author</code>, and similar,
that you may have seen in other package manager configuration files.  The one
option that matters here right now is:</p>
<div class="codehilite"><pre><span></span><code><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;hello&quot;</span>
</code></pre></div>

<p>This line specifies the name of your package, which determines the name of the
executable file of your program. In this example, our program executable, once
built, will be called <code>hello</code>.</p>
<p>Let’s now build this program using <em>fpm</em>:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>fpm<span class="w"> </span>build
<span class="c1"># gfortran (for build/debug/app/main.o)</span>
<span class="c1"># gfortran (for build/debug/app/hello)</span>
</code></pre></div>

<p>On the first line, we ran <code>fpm build</code> to compile and link the application.
The latter two lines are emitted by <em>fpm</em>, and indicate which command was
executed at each build step (<code>gfortran</code>), and which files have been output
by it: object file <code>main.o</code>, and executable <code>hello</code>.</p>
<p>We can now run the app with <code>fpm run</code>:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>fpm<span class="w"> </span>run
<span class="w"> </span>Hello,<span class="w"> </span>World!
</code></pre></div>

<p>If your application needs to use a module internally, but you don’t intend
to build it as a library to be used in other projects, you can include the
module in your program source file as well.
For example:</p>
<div class="codehilite"><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">app</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">f90</span>
<span class="k">module </span><span class="n">math_constants</span>
<span class="w">    </span><span class="kt">real</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">atan</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
<span class="k">end module </span><span class="n">math_constants</span>

<span class="k">program </span><span class="n">main</span>
<span class="w">    </span><span class="k">use </span><span class="n">math_constants</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">pi</span>
<span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Hello, World!&#39;</span>
<span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;pi = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">pi</span>
<span class="k">end program </span><span class="n">main</span>
</code></pre></div>

<p>Now, run this using <code>fpm run</code>:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>fpm<span class="w"> </span>run
<span class="c1"># gfortran (for build/debug/app/main.o)</span>
<span class="c1"># gfortran (for build/debug/app/hello)</span>
<span class="w"> </span>Hello,<span class="w"> </span>World!
<span class="w"> </span><span class="nv">pi</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="m">3</span>.14159274
</code></pre></div>

<p>Although we have named our program <code>hello</code>, which is the same name as the
package name in <code>fpm.toml</code>, you can name it anything you want as long as it’s
permitted by the language.</p>
<p>Notice that you can run <code>fpm run</code>, and if the package hasn’t been built yet,
<code>fpm build</code> will run automatically for you. This is true if the source files
have been updated since the last build.  Thus, if you want to run your
application, you can skip the <code>fpm build</code> step, and go straight to <code>fpm run</code>.</p>
<p>When running your application using <code>fpm run</code>, the program&rsquo;s exit code is
passed by <em>fpm</em> back to the operating system. So, it is possible to use Fortran
numbered <code>stop</code> and <code>error stop</code> codes to pass termination reasons back to the terminal.</p>
<p>Try running the following app with <code>fpm run</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">program </span><span class="n">main</span>
<span class="w">    </span><span class="k">use </span><span class="n">math_constants</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">pi</span>

<span class="w">    </span><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">angle</span>

<span class="w">    </span><span class="k">read</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span><span class="w"> </span><span class="n">angle</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ierr</span><span class="o">/=</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">       stop </span><span class="mi">2</span><span class="w"> </span><span class="c">! Not real</span>
<span class="w">    </span><span class="k">elseif</span><span class="w"> </span><span class="p">(</span><span class="n">angle</span><span class="o">&gt;</span><span class="n">pi</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">       stop </span><span class="mi">1</span>
<span class="w">    </span><span class="k">else</span>
<span class="k">       stop </span><span class="mi">0</span>
<span class="w">    </span><span class="k">endif</span>
<span class="k">end program </span><span class="n">main</span>
</code></pre></div>

<p>and then checking that the error code matches. Note that error codes are passed to variable <code>$?</code>
on Unix/Mac systems, and to environment variable <code>%errorlevel%</code> on Windows.</p>
<p>In this last example, our source file defined a <code>math_constants</code> module inside
the same source file as the main program. Let’s see how we can define an <em>fpm</em>
package that makes this module available as a library.</p>
<h3 id="single-module-library">Single-module library</h3>
<p>The package layout for this example looks like this:</p>
<div class="codehilite"><pre><span></span><code><span class="o">.</span>
<span class="err">├──</span><span class="w"> </span><span class="n">fpm</span><span class="o">.</span><span class="n">toml</span>
<span class="err">└──</span><span class="w"> </span><span class="n">src</span>
<span class="w">    </span><span class="err">└──</span><span class="w"> </span><span class="n">math_constants</span><span class="o">.</span><span class="n">f90</span>
</code></pre></div>

<p>In this example we’ll build a simple math constants library that exports
the number pi as a parameter:</p>
<div class="codehilite"><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">math_constants</span><span class="p">.</span><span class="n">f90</span>
<span class="k">module </span><span class="n">math_constants</span>
<span class="w">    </span><span class="kt">real</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">atan</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
<span class="k">end module </span><span class="n">math_constants</span>
</code></pre></div>

<p>and our <code>fpm.toml</code> is the same as before.</p>
<p>Now use <code>fpm build</code> to build the package:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>fpm<span class="w"> </span>build
<span class="c1"># gfortran (for build/debug/library/math_constants.o build/debug/library/math_constants.mod)</span>
<span class="c1"># ar (for build/debug/library/math_constants.a)</span>
ar:<span class="w"> </span>creating<span class="w"> </span>build/debug/library/math_constants.a
</code></pre></div>

<p>Based on the output of <code>fpm build</code>, <em>fpm</em> first ran <code>gfortran</code> to emit the
binary object (<code>math_constants.o</code>) and module (<code>math_constants.mod</code>) files.
Then it ran <code>ar</code> to create a static library archive <code>math_constants.a</code>.
<code>build/debug/library</code> is thus both your include and library path, should you
want to compile and link an external program with this library.</p>
<p>For modules in the top-level (<code>src</code>) directory, <em>fpm</em> requires that:</p>
<ul>
<li>The module has the same name as the source file.</li>
<li>There is only one module per file.</li>
</ul>
<p>These two requirements simplify the build process for <em>fpm</em>. As Fortran
compilers emit module files (<code>.mod</code>) with the same name as the module itself
(but not the source file, <code>.f90</code>), naming the module the same as the source file
allows <em>fpm</em> to:</p>
<ul>
<li>Uniquely and exactly map a source file (<code>.f90</code>) to its object (<code>.o</code>) and
module (<code>.mod</code>) files.</li>
<li>Avoid conflicts with modules of the same name that could appear in dependency
packages (more on this in a bit).</li>
</ul>
<p>Since this is a library without executable programs, <code>fpm run</code> here does
nothing.</p>
<p>In this example, our library is made of only one module. However, most
real-world libraries are likely to use multiple modules. Let’s see how you can
package your multi-module library.</p>
<h3 id="multi-module-library">Multi-module library</h3>
<p>In this example, we’ll use another module to define a 64-bit real kind
parameter and make it available in <code>math_constants</code> to define <code>pi</code> with
higher precision. To make this exercise worthwhile, we’ll define another math
constant, Euler’s number.</p>
<p>Our package layout looks like this:</p>
<div class="codehilite"><pre><span></span><code><span class="o">.</span>
<span class="err">├──</span><span class="w"> </span><span class="n">fpm</span><span class="o">.</span><span class="n">toml</span>
<span class="err">└──</span><span class="w"> </span><span class="n">src</span>
<span class="w">    </span><span class="err">├──</span><span class="w"> </span><span class="n">math_constants</span><span class="o">.</span><span class="n">f90</span>
<span class="w">    </span><span class="err">└──</span><span class="w"> </span><span class="n">type_kinds</span><span class="o">.</span><span class="n">f90</span>
</code></pre></div>

<p>And our source file contents are:</p>
<div class="codehilite"><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">math_constants</span><span class="p">.</span><span class="n">f90</span>
<span class="k">module </span><span class="n">math_constants</span>
<span class="w">    </span><span class="k">use </span><span class="n">type_kinds</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">rk</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">rk</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">atan</span><span class="p">(</span><span class="mf">1._rk</span><span class="p">)</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">rk</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">exp</span><span class="p">(</span><span class="mf">1._rk</span><span class="p">)</span>
<span class="k">end module </span><span class="n">math_constants</span>

<span class="err">$</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">type_kinds</span><span class="p">.</span><span class="n">f90</span>
<span class="k">module </span><span class="n">type_kinds</span>
<span class="w">    </span><span class="k">use </span><span class="n">iso_fortran_env</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">real64</span>
<span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">rk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">real64</span>
<span class="k">end module </span><span class="n">type_kinds</span>
</code></pre></div>

<p>and there are no changes to our <code>fpm.toml</code> relative to previous examples.</p>
<p>Like before, notice that the module <code>type_kinds</code> is name exactly as the
source file that contains it.
This is important.</p>
<p>By now you know how to build the package:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>fpm<span class="w"> </span>build
<span class="c1"># gfortran (for build/debug/library/type_kinds.o build/debug/library/type_kinds.mod)</span>
<span class="c1"># gfortran (for build/debug/library/math_constants.o build/debug/library/math_constants.mod)</span>
<span class="c1"># ar (for build/debug/library/math_constants.a)</span>
ar:<span class="w"> </span>creating<span class="w"> </span>build/debug/library/math_constants.a
</code></pre></div>

<p>Our build path now contains:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>ls<span class="w"> </span>build/debug/library/
math_constants.a<span class="w">  </span>math_constants.mod<span class="w">  </span>math_constants.o<span class="w">  </span>type_kinds.mod<span class="w">  </span>type_kinds.o
</code></pre></div>

<p>And the static library includes all the object files:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>nm<span class="w"> </span>build/debug/library/math_constants.a

math_constants.o:

type_kinds.o:
</code></pre></div>

<p>The takeaways from this example are that:</p>
<ul>
<li><em>fpm</em> automatically scanned the <code>src</code> directory for any source files.</li>
<li>It also resolved the dependency order between different modules.</li>
</ul>
<h3 id="application-and-library">Application and library</h3>
<p>Let’s now combine the two previous examples into one: We’ll build the math
constants library <em>and</em> an executable program that uses it. We’ll use this
program as a demo, and to verify that defining higher-precision constants from
the previous example actually worked.</p>
<p>Here’s the package layout for your application + library package:</p>
<div class="codehilite"><pre><span></span><code><span class="o">.</span>
<span class="err">├──</span><span class="w"> </span><span class="n">app</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">main</span><span class="o">.</span><span class="n">f90</span>
<span class="err">├──</span><span class="w"> </span><span class="n">fpm</span><span class="o">.</span><span class="n">toml</span>
<span class="err">└──</span><span class="w"> </span><span class="n">src</span>
<span class="w">    </span><span class="err">├──</span><span class="w"> </span><span class="n">math_constants</span><span class="o">.</span><span class="n">f90</span>
<span class="w">    </span><span class="err">└──</span><span class="w"> </span><span class="n">type_kinds</span><span class="o">.</span><span class="n">f90</span>
</code></pre></div>

<p>Our <code>fpm.toml</code> remains unchanged and our executable program source file is:</p>
<div class="codehilite"><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">app</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">f90</span>
<span class="k">program </span><span class="n">main</span>
<span class="w">    </span><span class="k">use </span><span class="n">math_constants</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">pi</span>
<span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;math_constants library demo&#39;</span>
<span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;pi = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">pi</span>
<span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;e = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span>
<span class="k">end program </span><span class="n">main</span>
</code></pre></div>

<p>Let’s go straight to running the demo program:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>fpm<span class="w"> </span>run
<span class="c1"># gfortran (for build/debug/library/type_kinds.o build/debug/library/type_kinds.mod)</span>
<span class="c1"># gfortran (for build/debug/library/math_constants.o build/debug/library/math_constants.mod)</span>
<span class="c1"># ar (for build/debug/library/math_constants.a)</span>
ar:<span class="w"> </span>creating<span class="w"> </span>build/debug/library/math_constants.a
<span class="c1"># gfortran (for build/debug/app/main.o)</span>
<span class="c1"># gfortran (for build/debug/app/math_constants)</span>
<span class="w"> </span>math_constants<span class="w"> </span>library<span class="w"> </span>demo
<span class="w"> </span><span class="nv">pi</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="m">3</span>.1415926535897931
<span class="w"> </span><span class="nv">e</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="m">2</span>.7182818284590451
</code></pre></div>

<p>The <em>fpm</em> build + run process works as expected, and our program correctly
outputs higher-precision constants.</p>
<p>So far we covered how <em>fpm</em> builds:</p>
<ul>
<li>A single program</li>
<li>A single-module library</li>
<li>A multi-module library</li>
<li>A program and a library</li>
</ul>
<p>However, all our modules so far have been organized in the top level source
directory. More complex libraries may organize their modules in subdirectories.
Let’s see how we can build this with <em>fpm</em>.</p>
<h3 id="multi-level-library">Multi-level library</h3>
<p>In this example, we’ll define our library as a collection of modules, two of
which are defined in a subdirectory:</p>
<div class="codehilite"><pre><span></span><code><span class="o">.</span>
<span class="err">├──</span><span class="w"> </span><span class="n">app</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">main</span><span class="o">.</span><span class="n">f90</span>
<span class="err">├──</span><span class="w"> </span><span class="n">fpm</span><span class="o">.</span><span class="n">toml</span>
<span class="err">└──</span><span class="w"> </span><span class="n">src</span>
<span class="w">    </span><span class="err">├──</span><span class="w"> </span><span class="n">math_constants</span>
<span class="w">    </span><span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">derived</span><span class="o">.</span><span class="n">f90</span>
<span class="w">    </span><span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">fundamental</span><span class="o">.</span><span class="n">f90</span>
<span class="w">    </span><span class="err">├──</span><span class="w"> </span><span class="n">math_constants</span><span class="o">.</span><span class="n">f90</span>
<span class="w">    </span><span class="err">└──</span><span class="w"> </span><span class="n">type_kinds</span><span class="o">.</span><span class="n">f90</span>
</code></pre></div>

<p>First, <code>fpm.toml</code> and <code>src/type_kinds.f90</code> remain unchanged relative to the
previous example.</p>
<p>The rest of the source files are:</p>
<div class="codehilite"><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">math_constants</span><span class="p">.</span><span class="n">f90</span>
<span class="k">module </span><span class="n">math_constants</span>
<span class="w">    </span><span class="k">use </span><span class="n">math_constants_fundamental</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">pi</span>
<span class="w">    </span><span class="k">use </span><span class="n">math_constants_derived</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">half_pi</span><span class="p">,</span><span class="w"> </span><span class="n">two_pi</span>
<span class="k">end module </span><span class="n">math_constants</span>

<span class="err">$</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">math_constants</span><span class="o">/</span><span class="n">fundamental</span><span class="p">.</span><span class="n">f90</span>
<span class="k">module </span><span class="n">math_constants_fundamental</span>
<span class="w">    </span><span class="k">use </span><span class="n">type_kinds</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">rk</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">rk</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">atan</span><span class="p">(</span><span class="mf">1._rk</span><span class="p">)</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">rk</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">exp</span><span class="p">(</span><span class="mf">1._rk</span><span class="p">)</span>
<span class="k">end module </span><span class="n">math_constants_fundamental</span>

<span class="err">$</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">math_constants</span><span class="o">/</span><span class="n">derived</span><span class="p">.</span><span class="n">f90</span>
<span class="k">module </span><span class="n">math_constants_derived</span>
<span class="w">    </span><span class="k">use </span><span class="n">math_constants_fundamental</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">pi</span>
<span class="w">    </span><span class="k">use </span><span class="n">type_kinds</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">rk</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">rk</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">two_pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pi</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">rk</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">half_pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pi</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span>
<span class="k">end module </span><span class="n">math_constants_derived</span>

<span class="err">$</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">app</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">f90</span>
<span class="k">program </span><span class="n">main</span>
<span class="w">    </span><span class="k">use </span><span class="n">math_constants</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">pi</span><span class="p">,</span><span class="w"> </span><span class="n">half_pi</span><span class="p">,</span><span class="w"> </span><span class="n">two_pi</span>
<span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;math_constants library demo&#39;</span>
<span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;pi = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">pi</span>
<span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2*pi = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">two_pi</span>
<span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;pi/2 = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">half_pi</span>
<span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;e = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span>
<span class="k">end program </span><span class="n">main</span>
</code></pre></div>

<p>Our top-level <code>math_constants</code> module now doesn’t define the constants, but
imports them from the two modules in the subdirectory. Constants <code>e</code> and <code>pi</code>
we define in the <code>math_constants_fundamental</code> module, and <code>two_pi</code> and <code>half_pi</code>
in the <code>math_constants_derived</code> module. From the main program, we access all
the constants from the top-level module <code>math_constants</code>.</p>
<p>Let’s build and run this package:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>fpm<span class="w"> </span>run
<span class="c1"># gfortran (for build/debug/library/type_kinds.o build/debug/library/type_kinds.mod)</span>
<span class="c1"># gfortran (for build/debug/library/math_constants_fundamental.o build/debug/library/math_constants_fundamental.mod)</span>
<span class="c1"># gfortran (for build/debug/library/math_constants_derived.o build/debug/library/math_constants_derived.mod)</span>
<span class="c1"># gfortran (for build/debug/library/math_constants.o build/debug/library/math_constants.mod)</span>
<span class="c1"># ar (for build/debug/library/math_constants.a)</span>
ar:<span class="w"> </span>creating<span class="w"> </span>build/debug/library/math_constants.a
<span class="c1"># gfortran (for build/debug/app/main.o)</span>
<span class="c1"># gfortran (for build/debug/app/math_constants)</span>
<span class="w"> </span>math_constants<span class="w"> </span>library<span class="w"> </span>demo
<span class="w"> </span><span class="nv">pi</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="m">3</span>.1415926535897931
<span class="w"> </span><span class="m">2</span>*pi<span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="m">6</span>.2831853071795862
<span class="w"> </span>pi/2<span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="m">1</span>.5707963267948966
<span class="w"> </span><span class="nv">e</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="m">2</span>.7182818284590451
</code></pre></div>

<p>Again, <em>fpm</em> built and run the package as expected.</p>
<p>Recall from an earlier example that <em>fpm</em> required the modules in the top-level
<code>src</code> directory to be named the same as their source file. This is why
<code>src/math_constants.f90</code> defines <code>module math_constants</code>.</p>
<p>For modules defined in subdirectories, there’s an additional requirement: module
name must contain the path components of the directory that its source file is
in.  In our case, <code>src/math_constants/fundamental.f90</code> defines the
<code>math_constants_fundamental</code> module.  Likewise, <code>src/math_constants/derived.f90</code>
defines the <code>math_constants_derived</code> module.</p>
<p>This rule applies generally to any number of nested directories and modules.
For example, <code>src/a/b/c/d.f90</code> must define a module called <code>a_b_c_d</code>.</p>
<p>Takeaways from this example are that:</p>
<ul>
<li>You can place your module source files in any levels of subdirectories inside <code>src</code>.</li>
<li>The module name must include the path components and the source file name&ndash;for example,
<code>src/a/b/c/d.f90</code> must define a module called <code>a_b_c_d</code>.</li>
</ul>
<h3 id="be-more-explicit">Be more explicit</h3>
<p>So far we’ve let <em>fpm</em> use its defaults to determine the layout of our package.
It determined where our library sources would live, what the name of the
executable will be, and some other things. But we can be more explicit about it,
and make some changes to those things.</p>
<p>Let’s look at what the <code>fpm.toml</code> file from our last example would look like if
we specified everything.</p>
<div class="codehilite"><pre><span></span><code><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;math_constants&quot;</span>
<span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0.1.0&quot;</span>
<span class="n">license</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;MIT&quot;</span>
<span class="n">author</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Jane Programmer&quot;</span>
<span class="n">maintainer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;jane@example.com&quot;</span>
<span class="n">copyright</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2020 Jane Programmer&quot;</span>

<span class="k">[library]</span>
<span class="n">source-dir</span><span class="o">=</span><span class="s2">&quot;src&quot;</span>

<span class="k">[[</span><span class="w"> </span><span class="k">executable</span><span class="w"> </span><span class="k">]]</span>
<span class="n">name</span><span class="o">=</span><span class="s2">&quot;math_constants&quot;</span>
<span class="n">source-dir</span><span class="o">=</span><span class="s2">&quot;app&quot;</span>
<span class="n">main</span><span class="o">=</span><span class="s2">&quot;main.f90&quot;</span>
</code></pre></div>

<p>You can see that by making these explicit in the <code>fpm.toml</code> we are able to
change many of the settings that <em>fpm</em> used by default. We can change the
folders where our sources are stored, we can change the name of our executable,
and we can change the name of the file our program is defined in.</p>
<h3 id="add-some-tests">Add some tests</h3>
<p><em>fpm</em> also provides support for unit testing. By default, <em>fpm</em> looks for a
program in <code>test/main.f90</code> which it will compile and execute with the command
<code>fpm test</code>. The tests are treated pretty much exactly like the executables.
Let’s define one explicitly in our <code>fpm.toml</code> file. We’ll make sure that our
definition of <code>pi</code> satisfies the property <code>sin(pi) == 0.0</code>. Here’s the
<code>fpm.toml</code> file:</p>
<div class="codehilite"><pre><span></span><code><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;math_constants&quot;</span>
<span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0.1.0&quot;</span>
<span class="n">license</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;MIT&quot;</span>
<span class="n">author</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Jane Programmer&quot;</span>
<span class="n">maintainer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;jane@example.com&quot;</span>
<span class="n">copyright</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2020 Jane Programmer&quot;</span>

<span class="k">[library]</span>
<span class="n">source-dir</span><span class="o">=</span><span class="s2">&quot;src&quot;</span>

<span class="k">[[</span><span class="w"> </span><span class="k">executable</span><span class="w"> </span><span class="k">]]</span>
<span class="n">name</span><span class="o">=</span><span class="s2">&quot;math_constants&quot;</span>
<span class="n">source-dir</span><span class="o">=</span><span class="s2">&quot;app&quot;</span>
<span class="n">main</span><span class="o">=</span><span class="s2">&quot;main.f90&quot;</span>

<span class="k">[[</span><span class="w"> </span><span class="k">test</span><span class="w"> </span><span class="k">]]</span>
<span class="n">name</span><span class="o">=</span><span class="s2">&quot;runTests&quot;</span>
<span class="n">source-dir</span><span class="o">=</span><span class="s2">&quot;test&quot;</span>
<span class="n">main</span><span class="o">=</span><span class="s2">&quot;main.f90&quot;</span>
</code></pre></div>

<p>where the contents of the <code>main.f90</code> file are</p>
<div class="codehilite"><pre><span></span><code><span class="k">program </span><span class="n">main</span>
<span class="w">    </span><span class="k">use </span><span class="n">math_constants</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">pi</span>
<span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;sin(pi) = &quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">sin</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>
<span class="k">end program </span><span class="n">main</span>
</code></pre></div>

<p>With this setup, we can run our tests.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>fpm<span class="w"> </span><span class="nb">test</span>
<span class="c1"># gfortran (for build/debug/library/type_kinds.o build/debug/library/type_kinds.mod)</span>
<span class="c1"># gfortran (for build/debug/library/math_constants_fundamental.o build/debug/library/math_constants_fundamental.mod)</span>
<span class="c1"># gfortran (for build/debug/library/math_constants_derived.o build/debug/library/math_constants_derived.mod)</span>
<span class="c1"># gfortran (for build/debug/library/math_constants.o build/debug/library/math_constants.mod)</span>
<span class="c1"># ar (for build/debug/library/math_constants.a)</span>
ar:<span class="w"> </span>creating<span class="w"> </span>build/debug/library/math_constants.a
<span class="c1"># gfortran (for build/debug/app/main.o)</span>
<span class="c1"># gfortran (for build/debug/app/math_constants)</span>
<span class="c1"># gfortran (for build/debug/test/main.o)</span>
<span class="c1"># gfortran (for build/debug/test/runTests)</span>
<span class="w"> </span>sin<span class="o">(</span>pi<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="m">1</span>.2246467991473532E-016
</code></pre></div>

<h3 id="adding-dependencies">Adding dependencies</h3>
<p>Inevitably, you’ll want to be able to include other libraries in your project.
fpm makes this incredibly simple, by taking care of fetching and compiling your
dependencies for you. You just tell it what your dependencies are, and where to
find them. Let’s add a dependency to our library. Now our <code>fpm.toml</code> file looks
like this:</p>
<div class="codehilite"><pre><span></span><code><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;math_constants&quot;</span>
<span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0.1.0&quot;</span>
<span class="n">license</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;MIT&quot;</span>
<span class="n">author</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Jane Programmer&quot;</span>
<span class="n">maintainer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;jane@example.com&quot;</span>
<span class="n">copyright</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2020 Jane Programmer&quot;</span>

<span class="k">[library]</span>
<span class="n">source-dir</span><span class="o">=</span><span class="s2">&quot;src&quot;</span>

<span class="k">[dependencies]</span>
<span class="n">helloff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;https://gitlab.com/everythingfunctional/helloff.git&quot;</span><span class="w"> </span><span class="p">}</span>

<span class="k">[[</span><span class="w"> </span><span class="k">executable</span><span class="w"> </span><span class="k">]]</span>
<span class="n">name</span><span class="o">=</span><span class="s2">&quot;math_constants&quot;</span>
<span class="n">source-dir</span><span class="o">=</span><span class="s2">&quot;app&quot;</span>
<span class="n">main</span><span class="o">=</span><span class="s2">&quot;main.f90&quot;</span>

<span class="k">[[</span><span class="w"> </span><span class="k">test</span><span class="w"> </span><span class="k">]]</span>
<span class="n">name</span><span class="o">=</span><span class="s2">&quot;runTests&quot;</span>
<span class="n">source-dir</span><span class="o">=</span><span class="s2">&quot;test&quot;</span>
<span class="n">main</span><span class="o">=</span><span class="s2">&quot;main.f90&quot;</span>
</code></pre></div>

<p>Now you can use any modules from this library anywhere in your code. Just like
this:</p>
<div class="codehilite"><pre><span></span><code><span class="k">program </span><span class="n">main</span>
<span class="w">    </span><span class="k">use </span><span class="n">helloff</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">create_greeting</span>
<span class="w">    </span><span class="k">use </span><span class="n">math_constants</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">pi</span><span class="p">,</span><span class="w"> </span><span class="n">half_pi</span><span class="p">,</span><span class="w"> </span><span class="n">two_pi</span>
<span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;math_constants library demo&#39;</span>
<span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;pi = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">pi</span>
<span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2*pi = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">two_pi</span>
<span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;pi/2 = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">half_pi</span>
<span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;e = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span>
<span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">create_greeting</span><span class="p">(</span><span class="s2">&quot;fpm&quot;</span><span class="p">)</span>
<span class="k">end program </span><span class="n">main</span>
</code></pre></div>

<p>And now, <code>fpm run</code> will output the following:</p>
<div class="codehilite"><pre><span></span><code><span class="w"> </span><span class="n">math_constants</span><span class="w"> </span><span class="n">library</span><span class="w"> </span><span class="n">demo</span>
<span class="w"> </span><span class="n">pi</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="mf">3.1415926535897931</span>
<span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="mf">6.2831853071795862</span>
<span class="w"> </span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="mf">1.5707963267948966</span>
<span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="mf">2.7182818284590451</span>
<span class="w"> </span><span class="n">Hello</span><span class="p">,</span><span class="w"> </span><span class="n">fpm</span><span class="o">!</span>
</code></pre></div>

<p>Additionally, any users of your library will now automatically depend on your
dependencies too. So if you don’t need that dependency for the library, like in
the above example, then you can specify it for the specific executable like
below. Then fpm will still fetch and compile it when building your executable,
but users of your library won’t have to.</p>
<div class="codehilite"><pre><span></span><code><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;math_constants&quot;</span>
<span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0.1.0&quot;</span>
<span class="n">license</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;MIT&quot;</span>
<span class="n">author</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Jane Programmer&quot;</span>
<span class="n">maintainer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;jane@example.com&quot;</span>
<span class="n">copyright</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2020 Jane Programmer&quot;</span>

<span class="k">[library]</span>
<span class="n">source-dir</span><span class="o">=</span><span class="s2">&quot;src&quot;</span>

<span class="k">[[</span><span class="w"> </span><span class="k">executable</span><span class="w"> </span><span class="k">]]</span>
<span class="n">name</span><span class="o">=</span><span class="s2">&quot;math_constants&quot;</span>
<span class="n">source-dir</span><span class="o">=</span><span class="s2">&quot;app&quot;</span>
<span class="n">main</span><span class="o">=</span><span class="s2">&quot;main.f90&quot;</span>
<span class="k">[executable.dependencies]</span>
<span class="n">helloff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;https://gitlab.com/everythingfunctional/helloff.git&quot;</span><span class="w"> </span><span class="p">}</span>

<span class="k">[[</span><span class="w"> </span><span class="k">test</span><span class="w"> </span><span class="k">]]</span>
<span class="n">name</span><span class="o">=</span><span class="s2">&quot;runTests&quot;</span>
<span class="n">source-dir</span><span class="o">=</span><span class="s2">&quot;test&quot;</span>
<span class="n">main</span><span class="o">=</span><span class="s2">&quot;main.f90&quot;</span>
</code></pre></div>

<p>You can also specify dependencies for your tests in a similar way, with
<code>[test.dependencies]</code> instead of <code>[executable.dependencies]</code>. There’s also
another option for test dependencies. The below example makes the dependencies
available for all the tests, but again your users won’t depend on these.</p>
<div class="codehilite"><pre><span></span><code><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;math_constants&quot;</span>
<span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0.1.0&quot;</span>
<span class="n">license</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;MIT&quot;</span>
<span class="n">author</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Jane Programmer&quot;</span>
<span class="n">maintainer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;jane@example.com&quot;</span>
<span class="n">copyright</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2020 Jane Programmer&quot;</span>

<span class="k">[library]</span>
<span class="n">source-dir</span><span class="o">=</span><span class="s2">&quot;src&quot;</span>

<span class="k">[dev-dependencies]</span>
<span class="n">helloff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;https://gitlab.com/everythingfunctional/helloff.git&quot;</span><span class="w"> </span><span class="p">}</span>

<span class="k">[[</span><span class="w"> </span><span class="k">executable</span><span class="w"> </span><span class="k">]]</span>
<span class="n">name</span><span class="o">=</span><span class="s2">&quot;math_constants&quot;</span>
<span class="n">source-dir</span><span class="o">=</span><span class="s2">&quot;app&quot;</span>
<span class="n">main</span><span class="o">=</span><span class="s2">&quot;main.f90&quot;</span>

<span class="k">[[</span><span class="w"> </span><span class="k">test</span><span class="w"> </span><span class="k">]]</span>
<span class="n">name</span><span class="o">=</span><span class="s2">&quot;runTests&quot;</span>
<span class="n">source-dir</span><span class="o">=</span><span class="s2">&quot;test&quot;</span>
<span class="n">main</span><span class="o">=</span><span class="s2">&quot;main.f90&quot;</span>
</code></pre></div>

<p>You can also be specific about which version of a dependency you’d like. You can
specify a branch to use like
<code>helloff = { git = "https://gitlab.com/everythingfunctional/helloff.git", branch = "master" }</code>,
or a tag like
<code>helloff = { git = "https://gitlab.com/everythingfunctional/helloff.git", tag = "v1.2.3" }</code>,
or even a specific commit like
<code>helloff = { git = "https://gitlab.com/everythingfunctional/helloff.git", rev = "a1b2c3" }</code>.
You can even specify the path to another folder, if for example you’ve got
another fpm package in the same repository. Like this:
<code>helloff = { path = "helloff" }</code>. Note that you should <em>not</em> specify paths
outside of your repository, or things won’t work for your users.</p>
<h3 id="custom-build-scripts">Custom build scripts</h3>
<p>If there is something special about your library that makes fpm unable to build
it, you can provide your own build script. fpm will then simply call your build
script to build the library.</p>
<p>To specify a build script to be used, put it in the library section of your
<code>fpm.toml</code> file, like:</p>
<div class="codehilite"><pre><span></span><code><span class="k">[library]</span>
<span class="n">source-dir</span><span class="o">=</span><span class="s2">&quot;src&quot;</span>
<span class="n">build-script</span><span class="o">=</span><span class="s2">&quot;my_build_script&quot;</span>
</code></pre></div>

<p><em>fpm</em> will set the following environment variables to specify some parameters to
the build script:</p>
<ul>
<li><code>FC</code> – The Fortran compiler to be used.</li>
<li><code>FFLAGS</code> – The flags that should be passed to the Fortran compiler.</li>
<li><code>BUILD_DIR</code> – Where the compiled files should be placed.</li>
<li><code>INCLUDE_DIRS</code> – The folders where any dependencies can be found, space separated.
It is then the responsibility of the build script to generate the appropriate
include flags.</li>
</ul>
<p>Additionally, script will be called with the name of the archive (<code>*.a</code> file)
that should be produced as the command line argument.</p>
<blockquote>
<p>Note: If the name of the build script is <code>Makefile</code> or ends with <code>.mk</code>, then
the make program will be used to run it. Not the the archive file is explicitly
specified as the target to be built</p>
<p>Note: All file and directory names are specified with their full canonical
path.</p>
</blockquote>
    </div>
  </div>
      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              Fortran-lang/fpm
 was developed by fortran-lang/fpm contributors<br>              &copy; 2025 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
 on 2025-09-06 07:53 +0000             </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>
  </body>
</html>